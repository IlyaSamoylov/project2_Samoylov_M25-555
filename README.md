# Проект 2 — Консольная база данных

![Python](https://img.shields.io/badge/Python-3.12-blue)
![Poetry](https://img.shields.io/badge/Poetry-управление_зависимостями-orange)

Программа представляет собой консольное приложение для имитации работы с базой данных.
Поддерживает создание и удаление таблиц, CRUD операции с данными. Хранит метаданные и записи таблиц в JSON. С помощью декораторов и замыканий реализованы обработка ошибок, подтверждение перед выполнением опасных операций, замер времени выполнения и кэширование

## Установка и запуск

## Быстрый старт

### Предварительные требования

- Python 3.11 или выше
- Poetry (менеджер зависимостей)
- Make (опционально, для удобства)

### Установка

1. **Клонируйте репозиторий:**
   ```bash
   git clone https://github.com/IlyaSamoylov/project2_Samoylov_M25-555
   cd labyrinth_game
   ```

2. **Установите poetry (если не установлен)**
   ### Windows
   pip install poetry

   ### Linux/macOS
   sudo apt install python3-poetry

3. **Настройте poetry, чтобы он создавал виртуальные окружения в директории проекта**
  ```bash
   poetry config virtualenvs.in-project true  
  ```
4. **Установите зависимости проекта**
  ```bash
  poetry install
  ```
  или 
  ```bash
  make install
  ```
5. **Активируйте виртуальное окружение**
  ### Linux
  ```bash
  poetry shell
  ```
  ### Windows
  ```bash
  source .venv/Scripts/activate
  ```
6. **Начните играть**
   ## через make:
   ```bash
    make run
   ```
   ## через poetry:
   ```bash
   poetry run database
   ```

## Управление таблицами

Доступные команды внутри программы:

| Команда                                         | Описание               |
| ----------------------------------------------- | ---------------------- |
| `create_table <имя_таблицы> <столбец1:тип> ...` | создать таблицу        |
| `list_tables`                                   | показать список таблиц |
| `drop_table <имя_таблицы>`                      | удалить таблицу        |
| `help`                                          | справочная информация  |
| `exit`                                          | выйти из программы     |

Поддерживаемые типы данных: `int`, `str`, `bool`.

## Пример работы

```
>>> create_table users name:str age:int is_active:bool
Таблица "users" успешно создана со столбцами: ID:int, name:str, age:int, is_active:bool
>>> list_tables
- users
>>> drop_table users 
Таблица "users" успешно удалена.
```


---

## Файл метаданных

Все данные о таблицах хранятся в `db_meta.json` в корне проекта.  
Пример содержимого:
```json
{     
	"users": {        
		"ID": "int",
		"name": "str",
		"age": "int",
		"is_active": "bool"
	}
}
```


---

## Разработка

- Установка зависимостей:
    
    `make install`
    
- Проверка кода линтером:
    
    `make lint`
    
- Сборка пакета:
    
    `make build`
    
- Тест публикации (без загрузки):
    
    `make publish`

## CRUD операции
| Команда                                                               | Описание             |
| --------------------------------------------------------------------- | -------------------- |
| `<command> insert into <имя_таблицы> values (...)`                    | добавить запись      |
| `<command> select from <имя_таблицы> [where <столбец> = <значение>]`  | показать записи      |
| `<command> update <имя_таблицы> set <столбец> = <значение> where ...` | обновить таблицу     |
| `<command> delete from <имя_таблицы> where <столбец> = <значение>`    | удалить запись       |
| `<command> info <имя_таблицы>`                                        | информация о таблице |

## Новые возможности (декораторы и кэширование)

### Обработка ошибок
Все критические функции базы данных обёрнуты декоратором `@handle_db_errors`.  
Он централизованно перехватывает и красиво выводит:
- `FileNotFoundError` — файл данных не найден,
- `KeyError` — отсутствующая таблица/столбец,
- `ValueError` — ошибки валидации,
- другие непредвиденные исключения.

### Подтверждение опасных действий
Операции, изменяющие структуру/данные (удаление таблицы, удаление записей), обёрнуты в `@confirm_action("<описание>")`.  
Пример: при `drop_table` появится:
```bash
Вы уверены, что хотите выполнить "удалить таблицу"? [y/n]:
```

### Логирование времени
Декоратор `@log_time` замеряет время выполнения тяжёлых операций (`select`, `insert`) и выводит:
```bash
Функция 'select' выполнилась за 0.012 секунд.
```

### Кэширование (замыкание)
Реализовано через `create_cacher()` — функция возвращает `cache_result(key, value_func)`.  
`select()` использует кэширование строкового вывода таблицы (PrettyTable). Повторные одинаковые запросы выдаются мгновенно и помечаются:
```bash
[КЭШ] Используется сохранённый результат для ключа: '...'
```
При изменении данных (insert, update, delete, drop_table) кэш очищается во избежание хранения в кэше устаревших данных .
